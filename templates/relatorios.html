{% extends "base.html" %}

{% block title %}Relatórios{% endblock %}

{% block content %}
<div class="container">
    <h1 class="my-4">Relatórios</h1>
    <form method="POST">
        <div class="row">
            <!-- Nome do cliente -->
            <div class="col-md-6 mb-3">
                <label for="nome" class="form-label">Nome do Cliente</label>
                <input type="text" class="form-control" id="nome" name="nome" placeholder="Digite o nome">
            </div>

            <!-- Data inicial -->
            <div class="col-md-3 mb-3">
                <label for="start_data" class="form-label">Data Inicial</label>
                <input type="date" class="form-control" id="start_data" name="start_data">
            </div>

            <!-- Data final -->
            <div class="col-md-3 mb-3">
                <label for="final_data" class="form-label">Data Final</label>
                <input type="date" class="form-control" id="final_data" name="final_data">
            </div>
        </div>

        <div class="row">
            <!-- Valor mínimo do pedido -->
            <div class="col-md-6 mb-3">
                <label for="valor_pedido" class="form-label">Valor Mínimo do Pedido</label>
                <input type="number" class="form-control" id="valor_pedido" name="valor_pedido" placeholder="Ex.: 500" step="0.01">
            </div>

            <!-- Top N produtos -->
            <div class="col-md-3 mb-3">
                <label for="tops" class="form-label">Top N Produtos</label>
                <input type="number" class="form-control" id="tops" name="tops" placeholder="Ex.: 10">
            </div>

            <!-- Intervalo de dias -->
            <div class="col-md-3 mb-3">
                <label for="intervalo" class="form-label">Intervalo de Dias</label>
                <input type="number" class="form-control" id="intervalo" name="intervalo" placeholder="Ex.: 30">
            </div>
        </div>

        <!-- Botão de envio -->
        <button type="submit" class="btn btn-primary">Gerar Relatório</button>
    </form>

    <!-- Mensagem de feedback -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="mt-4">
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Resultados -->
    {% if resultado %}
    <h2 class="my-4">Resultados</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID do Pedido</th>
                <th>Nome do Cliente</th>
                <th>Data do Pedido</th>
                <th>Total do Pedido</th>
            </tr>
        </thead>
        <tbody>
            {% for linha in resultado %}
            <tr>
                <td>{{ linha['ped_id'] }}</td>
                <td>{{ linha['cli_nome'] }}</td>
                <td>{{ linha['ped_data'] }}</td>
                <td>R$ {{ linha['ped_total'] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
</div>
{% endblock %}
